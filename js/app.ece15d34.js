(function(e){function t(t){for(var c,o,a=t[0],s=t[1],u=t[2],d=0,h=[];d<a.length;d++)o=a[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&h.push(r[o][0]),r[o]=0;for(c in s)Object.prototype.hasOwnProperty.call(s,c)&&(e[c]=s[c]);l&&l(t);while(h.length)h.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],c=!0,a=1;a<n.length;a++){var s=n[a];0!==r[s]&&(c=!1)}c&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var c={},r={app:0},i=[];function o(t){if(c[t])return c[t].exports;var n=c[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=c,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)o.d(n,c,function(t){return e[t]}.bind(null,c));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],s=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=s;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},4188:function(e,t,n){},"6e0e":function(e,t,n){"use strict";n("7f6b")},"7f6b":function(e,t,n){},"8bbf":function(e,t){e.exports=Vue},"931d":function(e,t,n){},adb1:function(e,t,n){},b70b:function(e,t,n){"use strict";n("931d")},c01c:function(e,t,n){"use strict";n("4188")},cae0:function(e,t,n){"use strict";n("adb1")},cd49:function(e,t,n){"use strict";n.r(t);n("7f17");var c=n("6573"),r=n.n(c),i=(n("47b1"),n("5a1e")),o=n.n(i),a=(n("4af4"),n("44fb")),s=n.n(a),u=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("b0c0"),n("8bbf"));n("7dd6");function l(e,t,n,c,r,i){var o=Object(u["resolveComponent"])("Scene"),a=Object(u["resolveComponent"])("Menu");return Object(u["openBlock"])(),Object(u["createBlock"])("div",{class:"container",style:{width:"".concat((e.game.width+6)*e.game.cellSize,"rem")}},[Object(u["createVNode"])(o,{widthNum:e.game.width,heightNum:e.game.height,cellSize:e.game.cellSize,paddingSize:e.game.paddingSize,matrix:e.game.matrix,nextBlock:e.game.nextBlock,keyRefresh:e.keyRefresh,score:e.game.score},null,8,["widthNum","heightNum","cellSize","paddingSize","matrix","nextBlock","keyRefresh","score"]),Object(u["createVNode"])(a,{state:e.game.state,keyEvents:e.keyMobile},null,8,["state","keyEvents"])],4)}var d=Object(u["withScopeId"])("data-v-c245c4b8");Object(u["pushScopeId"])("data-v-c245c4b8");var h={class:"game"},p={class:"refresh-btn"},v={class:"score"},f=Object(u["createVNode"])("span",null,"分数: ",-1),b={class:"next_block"},y=Object(u["createVNode"])("span",null,"Next",-1),_=Object(u["createStaticVNode"])('<div class="options-info" data-v-c245c4b8><p data-v-c245c4b8>操作提示</p><div data-v-c245c4b8><span data-v-c245c4b8>空格：</span><span data-v-c245c4b8>开始/暂停</span></div><div data-v-c245c4b8><span data-v-c245c4b8>R：</span><span data-v-c245c4b8>刷新</span></div><div data-v-c245c4b8><span data-v-c245c4b8>↑/W：</span><span data-v-c245c4b8>旋转</span></div><div data-v-c245c4b8><span data-v-c245c4b8>←/S：</span><span data-v-c245c4b8>左移</span></div><div data-v-c245c4b8><span data-v-c245c4b8>→/D：</span><span data-v-c245c4b8>右移</span></div><div data-v-c245c4b8><span data-v-c245c4b8>↓/S：</span><span data-v-c245c4b8>加速</span></div></div>',1);Object(u["popScopeId"])();var k=d((function(e,t,n,c,r,i){var o=Object(u["resolveComponent"])("Cell"),a=Object(u["resolveComponent"])("el-row"),s=Object(u["resolveComponent"])("el-button");return Object(u["openBlock"])(),Object(u["createBlock"])("div",{class:"scence-container",style:{padding:"".concat(e.paddingSize,"px")}},[Object(u["createVNode"])("div",h,[(Object(u["openBlock"])(!0),Object(u["createBlock"])(u["Fragment"],null,Object(u["renderList"])(e.matrix,(function(t,n){return Object(u["openBlock"])(),Object(u["createBlock"])(a,{key:n},{default:d((function(){return[(Object(u["openBlock"])(!0),Object(u["createBlock"])(u["Fragment"],null,Object(u["renderList"])(t,(function(t,n){return Object(u["openBlock"])(),Object(u["createBlock"])(o,{key:n,size:e.cellSize,paddingSize:e.paddingSize,value:t},null,8,["size","paddingSize","value"])})),128))]})),_:2},1024)})),128))]),Object(u["createVNode"])("div",{class:"controller",style:{width:5*e.cellSize+"rem"}},[Object(u["createVNode"])("div",p,[Object(u["createVNode"])(s,{type:"danger",circle:"",size:"small",icon:"el-icon-refresh",plain:"",onClick:t[1]||(t[1]=function(t){return e.keyRefresh()})})]),Object(u["createVNode"])("div",v,[f,Object(u["createVNode"])("span",null,Object(u["toDisplayString"])(e.score),1)]),Object(u["createVNode"])("div",b,[y,(Object(u["openBlock"])(!0),Object(u["createBlock"])(u["Fragment"],null,Object(u["renderList"])(e.nextBlock.shape,(function(t,n){return Object(u["openBlock"])(),Object(u["createBlock"])(a,{key:n},{default:d((function(){return[(Object(u["openBlock"])(!0),Object(u["createBlock"])(u["Fragment"],null,Object(u["renderList"])(t,(function(t,n){return Object(u["openBlock"])(),Object(u["createBlock"])(o,{key:n,size:e.cellSize-.5,paddingSize:e.paddingSize,value:t},null,8,["size","paddingSize","value"])})),128))]})),_:2},1024)})),128))]),_],4)],4)})),m=(n("a9e3"),n("2909")),g=n("d4ec"),O=n("bee2"),j=(n("159b"),[{key:"T",shape:[[1,1,1],[0,1,0]],source:[[0,0],[1,0],[-1,1],[0,-1]],x:-1,y:4},{key:"L",shape:[[1,0,0],[1,1,1]],source:[[0,0]],x:-1,y:4},{key:"J",shape:[[0,0,1],[1,1,1]],source:[[0,0]],x:-1,y:4},{key:"O",shape:[[1,1],[1,1]],source:[[0,0]],x:-1,y:4},{key:"I",shape:[[1,1,1,1]],source:[[-1,1],[1,-1]],x:0,y:3},{key:"Z",shape:[[1,1,0],[0,1,1]],source:[[0,0]],x:-1,y:4}]),x=function(){function e(t,n,c,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(g["a"])(this,e),this._key=t,this._shape=n,this._source=c,this._x=r,this._y=i,this._rotateIdx=o}return Object(O["a"])(e,[{key:"key",get:function(){return this._key},set:function(e){this._key=e}},{key:"shape",get:function(){return this._shape},set:function(e){this._shape=e}},{key:"source",get:function(){return this._source},set:function(e){this._source=e}},{key:"x",get:function(){return this._x},set:function(e){this._x=e}},{key:"y",get:function(){return this._y},set:function(e){this._y=e}},{key:"rotateIdx",get:function(){return this._rotateIdx},set:function(e){this._rotateIdx=e}},{key:"randomRenderBlock",value:function(){var t=Math.floor(Math.random()*j.length),n=j[t],c=n.key,r=n.shape,i=n.source,o=n.x,a=n.y;return new e(c,r,i,o,a)}},{key:"left",value:function(){return new e(this._key,this._shape,this._source,this._x,this._y-1,this._rotateIdx)}},{key:"right",value:function(){return new e(this._key,this._shape,this._source,this._x,this._y+1,this._rotateIdx)}},{key:"down",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new e(this._key,this._shape,this._source,this._x+t,this._y,this._rotateIdx)}},{key:"rotate",value:function(){var t,n=this._shape,c=[];n.forEach((function(e){return e.forEach((function(t,n){var r=e.length-n-1;void 0===c[r]&&(c[r]=[]),c[r].push(t),c[r]=Object(m["a"])(c[r])}))})),t=this._rotateIdx+1>=this._source.length?0:this._rotateIdx+1;var r=this._x+this._source[this._rotateIdx][0],i=this._y+this._source[this._rotateIdx][1];return new e(this._key,c,this._source,r,i,t)}}]),e}(),w=x,B=Object(u["withScopeId"])("data-v-7af3c193"),S=B((function(e,t,n,c,r,i){return Object(u["openBlock"])(),Object(u["createBlock"])("div",{class:0===e.value?"block":"block-active",style:{width:"".concat(e.size,"rem"),height:"".concat(e.size,"rem"),padding:"".concat(e.paddingSize,"px")}},[Object(u["createVNode"])("div",{class:0===e.value?"block-container":"block-active-container"},null,2)],6)})),N=Object(u["defineComponent"])({props:{size:Number,paddingSize:Number,value:Number}});n("cae0");N.render=S,N.__scopeId="data-v-7af3c193";var z=N,I=Object(u["defineComponent"])({name:"Scene",props:{cellSize:{type:Number,required:!0},paddingSize:{type:Number,required:!0},matrix:{type:Array,required:!0},nextBlock:{type:w,required:!0},score:{type:Number,required:!0},keyRefresh:{type:Function}},components:{Cell:z}});n("6e0e");I.render=k,I.__scopeId="data-v-c245c4b8";var E=I,V=Object(u["withScopeId"])("data-v-f116a9c4");Object(u["pushScopeId"])("data-v-f116a9c4");var M={class:"menu-container"},R={class:"left"},C={class:"right"},A={class:"up_btn"},T={class:"left_right_btns"},D={class:"down_btn"};Object(u["popScopeId"])();var L=V((function(e,t,n,c,r,i){var o=Object(u["resolveComponent"])("el-button");return Object(u["openBlock"])(),Object(u["createBlock"])("div",M,[Object(u["createVNode"])("div",R,[Object(u["createVNode"])(o,{size:"medium",type:"primary",circle:"",plain:"",icon:"start"===e.state?"el-icon-video-pause":"el-icon-video-play",style:{transform:"scale(2)"},onClick:t[1]||(t[1]=function(t){return e.keyEvents("Space")})},null,8,["icon"])]),Object(u["createVNode"])("div",C,[Object(u["createVNode"])("div",A,[Object(u["createVNode"])(o,{size:"medium",icon:"el-icon-caret-top",type:"primary",circle:"",onClick:t[2]||(t[2]=function(t){return e.keyEvents("ArrowUp")})})]),Object(u["createVNode"])("div",T,[Object(u["createVNode"])(o,{size:"medium",icon:"el-icon-caret-left",type:"primary",circle:"",onClick:t[3]||(t[3]=function(t){return e.keyEvents("ArrowLeft")})}),Object(u["createVNode"])(o,{size:"medium",icon:"el-icon-caret-right",type:"primary",circle:"",onClick:t[4]||(t[4]=function(t){return e.keyEvents("ArrowRight")})})]),Object(u["createVNode"])("div",D,[Object(u["createVNode"])(o,{size:"medium",icon:"el-icon-caret-bottom",type:"primary",circle:"",onClick:t[5]||(t[5]=function(t){return e.keyEvents("ArrowDown")})})])])])})),q=Object(u["defineComponent"])({props:{state:{type:String,required:!0},keyEvents:{type:Function,required:!0}}});n("b70b");q.render=L,q.__scopeId="data-v-f116a9c4";var J=q,K=(n("a434"),n("cb29"),function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:500,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0;Object(g["a"])(this,e),this._state=t,this._height=c,this._width=n,this._cellSize=r,this._paddingSize=i,this._matrix=this.renderDefaultMatrix(),this._curBlock=w.prototype.randomRenderBlock(),this._nextBlock=w.prototype.randomRenderBlock(),this._speed=o,this._downInterval=s,this._score=a}return Object(O["a"])(e,[{key:"state",get:function(){return this._state},set:function(e){this._state=e}},{key:"width",get:function(){return this._width},set:function(e){this._width=e}},{key:"height",get:function(){return this._height},set:function(e){this._height=e}},{key:"cellSize",get:function(){return this._cellSize},set:function(e){this._cellSize=e}},{key:"paddingSize",get:function(){return this._paddingSize},set:function(e){this._paddingSize=e}},{key:"matrix",get:function(){return this._matrix},set:function(e){this._matrix=e}},{key:"curBlock",get:function(){return this._curBlock},set:function(e){this._curBlock=e}},{key:"nextBlock",get:function(){return this._nextBlock},set:function(e){this._nextBlock=e}},{key:"speed",get:function(){return this._speed},set:function(e){this._speed=e}},{key:"score",get:function(){return this._score},set:function(e){this._score=e}},{key:"over",value:function(e){var t=this,n=!1;return e[0].forEach((function(e){2===e&&(n=!0,t._state="over",clearTimeout(t._downInterval))})),n}},{key:"start",value:function(){"over"===this._state&&(this._curBlock=this._nextBlock,this._nextBlock=w.prototype.randomRenderBlock()),this._state="start",this.autoDown()}},{key:"pause",value:function(){this._state="pause",clearTimeout(this._downInterval)}},{key:"refresh",value:function(){clearTimeout(this._downInterval),this._state="over",this._score=0,this._matrix=this.renderDefaultMatrix(),this._curBlock=w.prototype.randomRenderBlock(),this._nextBlock=w.prototype.randomRenderBlock(),this._speed=500,this._downInterval=void 0}},{key:"b_move",value:function(e){var t=this._curBlock[e]();this.canNext(t)&&(this._curBlock=t,this._matrix=this.renderNewMatrix(this._curBlock,this._matrix,1))}},{key:"b_down",value:function(){clearTimeout(this._downInterval);var e=this._curBlock.down();this.canNext(e)&&(this._curBlock=e,this._matrix=this.renderNewMatrix(this._curBlock,this._matrix,1)),this.autoDown()}},{key:"canNext",value:function(e){var t=this,n=e.x,c=e.y,r=e.shape,i=r[0].length;return r.every((function(e,r){return e.every((function(e,o){return!(c<0)&&(!(c+i>t._width)&&(!(n+r>=t._height)&&(n+r<0||(!e||2!==t._matrix[r+n][o+c]))))}))}))}},{key:"clearLine",value:function(e){var t=this,n=[];if(e.forEach((function(e,t){e.every((function(e){return 2===e}))&&n.push(t)})),n.length>0){this.computedScore(n.length*(this._width+1)-1);var c=JSON.parse(JSON.stringify(e));return n.forEach((function(e){c.splice(e,1),c.unshift(new Array(t._width).fill(0))})),c}}},{key:"renderDefaultMatrix",value:function(){for(var e=[[]],t=0;t<this._height;t++)e[t]=new Array(this._width).fill(0);return e}},{key:"renderNewMatrix",value:function(e,t,n){var c=e.shape,r=e.x,i=e.y,o=JSON.parse(JSON.stringify(t)),a=this.clearLine(t),s=0;return o.some((function(e){e.some((function(e,t,n){if(1===e&&(n[t]=0,s++),s>=4)return!0}))})),c.forEach((function(e,t){return e.forEach((function(e,c){if(e&&r+t>=0){var s=o[r+t];a||(s[i+c]=n,o[r+t]=s)}}))})),o}},{key:"autoDown",value:function(){var e=this;if(this.over(this._matrix))return clearTimeout(this._downInterval),r()({type:"error",message:"Game Over! 重新开始吧！"}),void this.refresh();var t=function t(){var n=e._curBlock,c=n.down();if(e.canNext(c))e._curBlock=c,e._matrix=e.renderNewMatrix(e._curBlock,e._matrix,1),e._downInterval=setTimeout(t,e._speed);else{var r=e.renderNewMatrix(e._curBlock,e._matrix,2),i=e.clearLine(r);e.nextAround(i||r)}};clearTimeout(this._downInterval),this._downInterval=setTimeout(t,this._speed)}},{key:"nextAround",value:function(e){var t=this;clearTimeout(this._downInterval),this._matrix=e,setTimeout((function(){t._curBlock=t._nextBlock,t._nextBlock=w.prototype.randomRenderBlock(),t.autoDown()}),100)}},{key:"computedScore",value:function(e){this._score=this._score+e}}]),e}()),P=K,F=function(){function e(){Object(g["a"])(this,e)}return Object(O["a"])(e,[{key:"keyEvents",value:function(e,t){if("Space"===e||"start"===t.state||"KeyR"===e)switch(navigator.vibrate&&navigator.vibrate(50),e){case"Space":return void("over"===t.state||"pause"===t.state?t.start():"start"===t.state&&t.pause());case"ArrowLeft":case"KeyA":return void t.b_move("left");case"ArrowRight":case"KeyD":return void t.b_move("right");case"ArrowUp":case"KeyW":return void t.b_move("rotate");case"ArrowDown":case"KeyS":return void t.b_down();case"KeyR":return void t.refresh()}}}]),e}(),U=F,W=Object(u["defineComponent"])({name:"App",components:{Scene:E,Menu:J},setup:function(){var e=Object(u["ref"])(24),t=Object(u["ref"])(12),n=document.documentElement.clientWidth;n>=1200&&(document.documentElement.style.fontSize="14px",e.value=20),n<=500&&n>=340&&(document.documentElement.style.fontSize="10px"),n<=340&&(document.documentElement.style.fontSize="10px",e.value=16,t.value=8);var c=Object(u["reactive"])(new P("over",t.value,e.value,2,2)),r=new U,i=function(e){r.keyEvents(e.code,c)},o=function(e){r.keyEvents(e,c)},a=function(){r.keyEvents("KeyR",c)};return Object(u["onMounted"])((function(){window.addEventListener("keydown",i)})),Object(u["onUnmounted"])((function(){window.removeEventListener("keydown",i)})),{game:c,keyEvents:i,keyMobile:o,keyRefresh:a}}});n("c01c");W.render=l;var G=W,Z=Object(u["createApp"])(G);Z.component(s.a.name,s.a),Z.component(o.a.name,o.a),Z.component(r.a.name,r.a),Z.mount("#app")}});
//# sourceMappingURL=app.ece15d34.js.map